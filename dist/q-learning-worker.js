(()=>{"use strict";const t=[],e=new class{constructor(t=.95,e=.005,s=.7){this.position={x:150,y:150},this.gravity=45,this.dy=0,this.qValues={},this.discount=t,this.epsilon=e,this.learningRate=s,this.reward=0}update(t){this.dy=this.dy+t/this.gravity,this.position.y=Math.round(this.position.y+this.dy)}getAgentPosition(){return this.position}getBestAction(t){const e=this.getLegalActions(),s=Math.floor(Math.random()*e.length);let i=-1/0,n=null;for(let s in e){const e=this.getQValue(t,s);e>i&&(i=e,n=s)}return Math.random()<this.epsilon?e[s]:n}getQValue(t,e){return this.qValues[t]||(this.qValues[t]=[0,0]),this.qValues[t][e]}updateQValue(t,e,s,i){const n=this.getLegalActions(),a=Math.max(...n.map((t=>this.getQValue(s,t)))),r=this.getQValue(t,e),o=i+this.discount*a-r;this.qValues[t][e]=r+this.learningRate*o}getLegalActions(){return[0,1]}takeAction(t){1===Number(t)&&(this.dy=-3)}reset(){this.position={x:150,y:150},this.dy=0,this.reward=0}getReward(){return this.reward}updateReward(t){this.reward+=t}getQValues(){return this.qValues}},s=new class{constructor(){this.pipe={x:670,height:150},this.pipeSpeed=.13333333333333333}getPipePosition(){return this.pipe}update(t){this.pipe.x=Math.round(this.pipe.x+-t*this.pipeSpeed),this.pipe.x<-50&&this.reset()}getReward(t){return this.isTerminalState(t)?-1e3:1}reset(){this.pipe={x:670,height:150}}isTerminalState(t){const{nextPipeDistanceX:e,nextPipeDistanceY:s,nextDistanceGround:i}=t;return i<=20||e<=20&&s<=20&&!(e<=-75)}getRandomArbitrary(t,e){return Math.floor(Math.random()*(e-t)+t)}},i={position:{x:0,y:272}};function n(n){const a=s.getPipePosition(),r=e.getAgentPosition(),o=Math.round(a.x-r.x),h=Math.round(a.height-r.y),p=Math.round(i.position.y-r.y),u=e.getBestAction([o,h,p]);e.takeAction(u),e.update(n),s.update(n);const l=s.getPipePosition(),g=e.getAgentPosition(),d=Math.round(l.x-g.x),c=Math.round(l.height-g.y),y=Math.round(i.position.y-g.y),A={currentPipeDistanceX:o,currentPipeDistanceY:h,currentDistanceGround:p},m={nextPipeDistanceX:d,nextPipeDistanceY:c,nextDistanceGround:y},x=s.getReward(A,u,m);e.updateReward(x),e.updateQValue([o,h,p],u,[d,c,y],x);const M=e.getReward(),P=s.isTerminalState(m);return(P||M>1e4)&&(t.push({x:t.length+1,y:M}),e.reset(),s.reset()),P||M>1e4}self.onmessage=s=>{const{type:i,parameters:a}=s.data;if("START_TRAINING"===i){const{iterations:t,fps:e}=a;!function(t,e,s){let i=t;const a=1e3/e;for(let t=0;t<i;t++){let e=!1;t%1e3==0&&self.postMessage({type:"PROGRESS",parameters:{iteration:t}});do{e=n(a)}while(!e)}self.postMessage({type:"END_TRAINING",parameters:null})}(t,e)}"EXPORT_Q_VALUES"===i&&self.postMessage({type:"Q_VALUES",parameters:{qValues:e.getQValues()}}),"EXPORT_SCORES"===i&&self.postMessage({type:"SCORES",parameters:{scores:t}}),"CHANGE_ALPHA"===i&&(e.learningRate=a.alpha),"CHANGE_EPSILON"===i&&(e.epsilon=a.epsilon),"CHANGE_GAMMA"===i&&(e.gamma=a.gamma)}})();